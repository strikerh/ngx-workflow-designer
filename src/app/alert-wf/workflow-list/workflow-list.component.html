<app-page-header
  [title]="'Workflow List' | transloco "
  [actions]="actions"
>
</app-page-header>
<div @fadeInUp *ngIf="loading && paginatedList.length === 0" class="w-full text-center py-8 min-h-lg px-4 grow">
  <app-loading class="w-full"></app-loading>
</div>
<main  @fadeInUp class="w-full px-4  rounded-lg  grow  flex flex-wrap content-start gap-y-4 overflow-auto "
      *ngIf="showMode=='card' && paginatedList.length !== 0">

  <!-- Workflows list -->
  <div class="min-w-1/2 grow xl:w-1/2 pe-1"
       *ngFor="let workflow of paginatedList"
  >
    <section (click)="selectWorkflow(workflow);$event.stopPropagation();"
             class="w-full h-full overflow-hidden min-h-20 bg-white cursor-pointer flex gap-2 p-2 border hover:bg-gray-100 group
            border-gray-300 rounded-xl items-stretch justify-start text-start relative">

      <div class="flex  px-3 items-center shrink-0">
        <div class="rounded-lg h-16 py-2 px-4 my-1 flex item-center justify-center"
        >
          <span class="material-icons text-primary" style="font-size: 36px;">account_tree</span>

        </div>
      </div>
      <div class="flex flex-col px-3">
        <label class="text-sm text-gray-500">{{ "Name" | transloco }}</label>
        <div class="text-base text-black font-semibold min-w-20">{{ workflow.name }}</div>
      </div>
      <div class="flex flex-col px-3">
        <label class="text-sm text-gray-500">{{ "Category" | transloco }}</label>
        <div class="text-base text-black font-semibold min-w-20">{{ getWorkflowCategory(workflow) }}</div>
      </div>

      <div class="flex flex-col px-3 grow">
        <label class="text-sm text-gray-500">{{ "Priority" | transloco }}</label>
        <div class="text-base text-black font-semibold min-w-20">{{ getWorkflowPriority(workflow) }}</div>
      </div>

      <div
        class="px-3 items-center shrink-0 absolute end-0 top-0 bottom-0 hidden group-hover:flex bg-gray-100 shadow-[-1rem_0_1rem_1rem_#f3f4f6]">

        <button pRipple type="button"
                class="p-2 rounded-lg pointer-events-auto relative hover:bg-gray-300/50 hover:text-primary-500"
                (click)="editWorkflow(workflow);$event.stopPropagation();">
          <span class=" material-icons text-2xl   material-symbols-outlined">edit</span>
        </button>
        <button pRipple type="button"
                class="p-2 rounded-lg  pointer-events-auto relative hover:bg-gray-300/50 hover:text-red-500 "
                (click)="deleteWorkflow(workflow.workflowId.toString(), workflow.name);$event.stopPropagation()">
          <span class=" material-icons text-2xl   material-symbols-outlined">delete</span>
        </button>

      </div>
    </section>
  </div>

</main>
<main class="w-full flex" *ngIf="showMode=='table' && paginatedList.length !== 0" >
  <div class="w-0 grow">
    <p-table [value]="paginatedList" class="max-w-96" [tableStyle]="{ 'min-width': '24rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th class="bg-primary text-white rounded-tl">{{ "Id" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Name" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Category" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Priority" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Author" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Version" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Created At" | transloco }}</th>
          <th class="bg-primary text-white">{{ "Updated At" | transloco }}</th>
          <th class="bg-primary text-white rounded-tr">{{ "Action" | transloco }}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-workflow>
        <tr class="hover:bg-gray-200 cursor-pointer" (click)="selectWorkflow(workflow)">
          <td>{{ workflow.id }}</td>
          <td class="capitalize">{{ workflow.name }}</td>
          <td>{{ getWorkflowCategory(workflow) }}</td>
          <td>{{ getWorkflowPriority(workflow) }}</td>
          <td>{{ workflow.metadata?.author || 'Unknown' }}</td>
          <td>{{ workflow.metadata?.version || '1.0' }}</td>
          <td>{{ formatDate(workflow.createdAt) }}</td>
          <td>{{ formatDate(workflow.updatedAt) }}</td>
          <td>
            <div class="flex gap-4">
              <span pTooltip="Delete Workflow" tooltipPosition="bottom"
                    class=" material-icons text-2xl  text-gray-700 cursor-pointer"
                    (click)="deleteWorkflow(workflow.id, workflow.name);$event.stopPropagation()">delete</span>
              <span class=" material-icons text-2xl text-gray-700 cursor-pointer" pTooltip="Edit Workflow"
                    tooltipPosition="bottom" (click)="editWorkflow(workflow);$event.stopPropagation()">edit</span>
            </div>

          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

</main>
<p-paginator
  [rows]="pageSize"
  [totalRecords]="filteredData.length"
  [first]="currentPage * pageSize"
  (onPageChange)="onPageChange($event)"
  class="w-full mt-auto">
</p-paginator>


@if (loading && paginatedList.length !== 0) {

  <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-200/40">
    <span class="material-icons animate-spin text-primary-500 text-4xl">refresh</span>
    <p class="mt-2 text-gray-600">{{ "Loading Workflows" | transloco }}...</p>
  </div>
}

<p-confirmDialog/>
<p-toast/>
